{"ast":null,"code":"import { renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, createCommentVNode as _createCommentVNode, vShow as _vShow, withDirectives as _withDirectives, resolveComponent as _resolveComponent, createVNode as _createVNode } from \"vue\";\nconst _hoisted_1 = {\n  class: \"mainshares shares\"\n};\nconst _hoisted_2 = {\n  class: \"card\",\n  id: \"shareAloneComments\"\n};\nconst _hoisted_3 = {\n  key: 0\n};\nconst _hoisted_4 = {\n  class: \"card__info--text card__info--sharetext\"\n};\n\nconst _hoisted_5 = /*#__PURE__*/_createElementVNode(\"div\", {\n  class: \"separator\"\n}, null, -1\n/* HOISTED */\n);\n\nconst _hoisted_6 = {\n  class: \"card__info--complement\"\n};\nconst _hoisted_7 = {\n  hidden: \"\"\n};\nconst _hoisted_8 = {\n  hidden: \"\",\n  id: \"CommentOnACommentId\"\n};\nconst _hoisted_9 = {\n  class: \"btn-div\"\n};\nconst _hoisted_10 = {\n  class: \"container\"\n};\nconst _hoisted_11 = {\n  class: \"btn-div\",\n  id: \"ShareAccess\"\n};\nconst _hoisted_12 = {\n  class: \"formSection\",\n  id: \"ShareForm\"\n};\nconst _hoisted_13 = {\n  class: \"formDiv\"\n};\nconst _hoisted_14 = {\n  type: \"multipart/form-data\",\n  method: \"POST\",\n  name: \"form\",\n  id: \"CommentToBePosted\",\n  class: \"formulaire\"\n};\nconst _hoisted_15 = {\n  class: \"formLine\"\n};\n\nconst _hoisted_16 = /*#__PURE__*/_createElementVNode(\"label\", {\n  for: \"CommentText\",\n  class: \"label\"\n}, \"Votre commentaire\", -1\n/* HOISTED */\n);\n\nconst _hoisted_17 = {\n  class: \"btn-div\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_PostACommentOnAComment = _resolveComponent(\"PostACommentOnAComment\");\n\n  return _openBlock(), _createElementBlock(\"section\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.apiCommentsResponse, item => {\n    return _openBlock(), _createElementBlock(\"div\", {\n      id: \"commentDiv\",\n      key: item.shareShareId,\n      class: \"card card__info card__info--2\"\n    }, [item.CommentId ? (_openBlock(), _createElementBlock(\"div\", _hoisted_3, [_createElementVNode(\"div\", null, [_createElementVNode(\"p\", _hoisted_4, _toDisplayString(item.CommentText), 1\n    /* TEXT */\n    )]), _hoisted_5, _createElementVNode(\"div\", _hoisted_6, [_createElementVNode(\"div\", null, [_createElementVNode(\"p\", null, _toDisplayString(item.user.UserFirstname) + \" \" + _toDisplayString(item.user.UserName) + \" / \" + _toDisplayString(item.user.UserDepartement) + \" / \" + _toDisplayString(item.user.UserRole), 1\n    /* TEXT */\n    ), _createElementVNode(\"p\", null, _toDisplayString($options.formatDate(item.updatedAt)), 1\n    /* TEXT */\n    ), _createCommentVNode(\" le commentateur du Share \"), _createElementVNode(\"p\", _hoisted_7, _toDisplayString(item.commentCommentId), 1\n    /* TEXT */\n    ), _createElementVNode(\"p\", _hoisted_8, _toDisplayString(item.CommentId), 1\n    /* TEXT */\n    )])])])) : _createCommentVNode(\"v-if\", true), _createElementVNode(\"div\", _hoisted_9, [_withDirectives(_createElementVNode(\"button\", {\n      type: \"button\",\n      class: \"btn\",\n      onClick: _cache[0] || (_cache[0] = $event => $options.modifyComment()),\n      id: \"modifyCommentBtn\"\n    }, \"Corriger\", 512\n    /* NEED_PATCH */\n    ), [[_vShow, item.userUserId == $data.loggedUserId || _ctx.isAdmin]]), _withDirectives(_createElementVNode(\"button\", {\n      type: \"button\",\n      class: \"btn\",\n      onClick: _cache[1] || (_cache[1] = $event => $options.deleteComment()),\n      id: \"deleteCommentBtn\"\n    }, \"Effacer\", 512\n    /* NEED_PATCH */\n    ), [[_vShow, item.userUserId == $data.loggedUserId || _ctx.isAdmin]])]), _createElementVNode(\"section\", _hoisted_10, [_withDirectives(_createElementVNode(\"div\", _hoisted_11, [_createElementVNode(\"button\", {\n      type: \"button\",\n      class: \"btn\",\n      onClick: _cache[2] || (_cache[2] = $event => _ctx.displayForm()),\n      id: \"GoToShare\",\n      value: \"Partager\"\n    }, \" Un commentaire ? \")], 512\n    /* NEED_PATCH */\n    ), [[_vShow, _ctx.ShareFormHidden]]), _withDirectives(_createElementVNode(\"div\", _hoisted_12, [_createElementVNode(\"div\", _hoisted_13, [_createElementVNode(\"form\", _hoisted_14, [_createCommentVNode(\"Le Comment\"), _createElementVNode(\"div\", _hoisted_15, [_hoisted_16, _createElementVNode(\"textarea\", {\n      class: \"bigtextarea textarea input\",\n      form: \"CommentToBePosted\",\n      type: \"textarea\",\n      onInput: _cache[3] || (_cache[3] = (...args) => _ctx.checkForm && _ctx.checkForm(...args)),\n      placeholder: \"...\",\n      autofocus: \"\",\n      id: \"CommentText\",\n      name: \"CommentText\"\n    }, null, 32\n    /* HYDRATE_EVENTS */\n    )]), _createElementVNode(\"div\", _hoisted_17, [_createElementVNode(\"button\", {\n      type: \"button\",\n      class: \"btn\",\n      onClick: _cache[4] || (_cache[4] = $event => _ctx.displayGoTo()),\n      id: \"CancelBtn\"\n    }, \"Annuler\"), _createElementVNode(\"button\", {\n      type: \"button\",\n      class: \"btn\",\n      onClick: _cache[5] || (_cache[5] = $event => _ctx.Comment()),\n      id: \"CommentBtn\",\n      disabled: \"\"\n    }, \"Commenter\")])])])], 512\n    /* NEED_PATCH */\n    ), [[_vShow, !_ctx.ShareFormHidden]])]), _withDirectives(_createVNode(_component_PostACommentOnAComment, null, null, 512\n    /* NEED_PATCH */\n    ), [[_vShow, item.userUserId != $data.loggedUserId || _ctx.isAdmin]])]);\n  }), 128\n  /* KEYED_FRAGMENT */\n  ))])]);\n}","map":{"version":3,"mappings":"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","names":["class","id","_createElementVNode","hidden","type","method","name","for","_createElementBlock","_Fragment","_renderList","$data","item","key","shareShareId","CommentId","_hoisted_3","_toDisplayString","CommentText","_hoisted_5","user","UserFirstname","UserName","UserDepartement","UserRole","$options","updatedAt","_createCommentVNode","commentCommentId","onClick","userUserId","_ctx","value","_hoisted_16","form","onInput","placeholder","autofocus","disabled","_createVNode","_component_PostACommentOnAComment"],"sourceRoot":"","sources":["/Users/stefan/Library/Mobile Documents/com~apple~CloudDocs/08 WEB ET SITES/P7/frontend/src/components/ShareAloneComments.vue"],"sourcesContent":["<template>\n\n                    <section class=\"mainshares shares\">\n\n                       <div class=\"card\" id=\"shareAloneComments\" >\n                         <div  id=\"commentDiv\" \n                          v-for=\"item in apiCommentsResponse\"\n                          :key=\"item.shareShareId\"\n                          class=\"card card__info card__info--2\">\n                                <div v-if=\"item.CommentId\" >\n                                  <div>\n                                    <p class=\"card__info--text card__info--sharetext\">{{ item.CommentText }}</p>\n                                  </div>\n                                  <div class=\"separator\"></div>\n                                  <div class=\"card__info--complement\">\n                                    <div>\n                                       <p> {{ item.user.UserFirstname }} {{ item.user.UserName }} / {{ item.user.UserDepartement }} / {{ item.user.UserRole }}</p>\n                                       <p>{{ formatDate(item.updatedAt) }}</p> <!-- le commentateur du Share -->\n                                       <p hidden>{{ item.commentCommentId }} </p>\n                                       <p hidden id=\"CommentOnACommentId\">{{ item.CommentId }}</p>\n                                    </div>\n                                   \n                                  </div>\n \n                                </div>\n\n                                <div class=\"btn-div\">\n                                        <button v-show=\"item.userUserId==loggedUserId  || isAdmin\" type=\"button\" class=\"btn\" @click=\"modifyComment()\" id=\"modifyCommentBtn\">Corriger</button>\n                                        <button v-show=\"item.userUserId==loggedUserId  || isAdmin\" type=\"button\" class=\"btn\" @click=\"deleteComment()\" id=\"deleteCommentBtn\">Effacer</button>\n                                </div>\n\n                                <section class = \"container\">\n      <div class=\"btn-div\" id=\"ShareAccess\" v-show=\"ShareFormHidden\">\n        <button type=\"button\" \n                class=\"btn\" \n                @click=\"displayForm()\" \n                id=\"GoToShare\" \n                value=\"Partager\">\n                Un commentaire ?\n        </button>\n      </div>\n      <div class = \"formSection\" id=\"ShareForm\" v-show=\"!ShareFormHidden\" >\n          <div class = \"formDiv\">\n                    <form     \n                              type=\"multipart/form-data\"\n                              method=\"POST\" \n                              name=\"form\" \n                              id=\"CommentToBePosted\"\n                              class=\"formulaire\">\n                              \n                              <!--Le Comment-->\n                               <div class=\"formLine\">\n                                        <label    \n                                                  for=\"CommentText\" \n                                                  class=\"label\">Votre commentaire</label>\n                                        <textarea class=\"bigtextarea textarea input\"\n                                                  form=\"CommentToBePosted\" \n                                                  type=\"textarea\"\n                                                  @input=\"checkForm\"\n                                                 \n                                                  placeholder= \"...\"\n                                                  autofocus\n                                                  id=\"CommentText\"\n                                                  name=\"CommentText\"></textarea>\n                              </div>\n                              \n                              <div class=\"btn-div\">\n                                        <button type=\"button\" class=\"btn\" @click=\"displayGoTo()\" id=\"CancelBtn\">Annuler</button>\n                                        <button type=\"button\" class=\"btn\" @click=\"Comment()\" id=\"CommentBtn\" disabled>Commenter</button>\n                              </div>\n                    </form>\n          </div>\n      </div>\n    </section>\n\n                                <PostACommentOnAComment v-show=\"item.userUserId!=loggedUserId || isAdmin\"/>\n                                          \n\n                       </div>\n                       \n                       </div>\n\n                     \n                      \n                    </section>\n                    \n\n          \n</template>\n\n<script>\nimport PostACommentOnAComment from \"@/components/PostACommentOnAComment.vue\"\nimport dayjs from 'dayjs'\nrequire('dayjs/locale/fr')\ndayjs.locale('fr')\n\nexport default {\n          name : 'ShareAlone',\n          components: {\n                              PostACommentOnAComment\n          },\n\n          \n\n          data(){\n                    return{\n\n                            loggedUserId: \"\",\n                            apiCommentsResponse : Array,\n                            apiLength : Number,\n\n                            CommentId : \"\",\n                            CommentText : \"\",\n                            CommentcreatedAt : \"\",\n                            CommentupdatedAt : \"\",\n                            CommentuserUserId : \"\", \n\n                            modifyForm :{\n                              type: Boolean,\n                              default: true },\n\n                    }\n          },\n\n          methods : {\n\n            formatDate(dateString) {\n                            const date = dayjs(dateString);\n                                // Then specify how you want your dates to be formatted\n                            return date.format('dddd D MMMM YYYY , HH:mm');\n                      },\n\n            modifyComment() {\n                  this.modifyForm = false;\n            },\n            doNotModify(){\n                  this.modifyForm = true;\n            },\n\n            correctComment(){\n                    const ShareToBeCorrected = document.getElementById(\"ShareToBeCorrected\");\n                    const ShareId = new URL(window.location.href).hash.split(\"=\")[1];\n                    const Token = JSON.parse(sessionStorage.getItem(\"Token\"));\n                    const Modify = new FormData(ShareToBeCorrected);\n\n                    Modify.append('ShareId',ShareId)\n\n\n                    //--- TEST ---- ///\n                    // for(var pair of Modify.entries()) {\n                    //   console.log(pair[0]+ ', '+ pair[1]);\n                    // }\n\n                    fetch(`http://localhost:3000/api/shares/${ShareId}`, {\n                              method: 'PUT',\n                              headers: {\n                                  \"Accept\":\"*/*\",\n                                  // \"Content-Type\": \"multipart/form-data\", \n                                  \"Authorization\": \"Bearer \" + Token\n                              },\n                              body: Modify,\n                              mode : \"cors\"})\n\n                    .then((response) => {\n\n                              if (response.status == 201) { \n                                        this.success= true;\n                                        this.message = \"Mise à jour effectuée.\";\n                                        this.modifyForm = true;\n                                        this.$router.push({ name: 'wall' });\n                                        this.$router.go(0);\n                                        // history.go(0);\n                              } else {\n                                        response.json ()\n                                        .then ((json) => {\n                                        this.success= false;\n                                        console.log(json);\n                                        this.message = json.error ||  json.message ;\n                                        return this.message\n                                        })\n                              }\n                    })\n                    .catch (() => {\n                              this.success= false;\n                              this.message = `Le serveur ne répond pas ! Veuillez réessayer ultérieurement`;\n                    })         \n\n            },\n            deleteComment() {\n\n                          const  Token = JSON.parse(sessionStorage.getItem(\"Token\"));\n                          // const loggedUserId=JSON.parse(sessionStorage.getItem(\"UserId\"))\n                          const ShareId = new URL(window.location.href).hash.split(\"=\")[1];\n                          const Share = {\n                            \"ShareId\" : ShareId\n                          }\n\n                          const deleteShare = confirm(\"Le commentaire et tous les commentaires associés vont être effacés\")\n\n                          if (deleteShare){\n                            fetch(`http://localhost:3000/api/comments/${ShareId}`, {\n                              method: 'DELETE',\n                              headers: {\"Content-Type\": \"application/json\", \n                                        \"Authorization\": \"Bearer \" + Token\n                              },\n                              body: JSON.stringify(Share),\n                              mode : \"cors\"\n                            })\n                            .then(() => {\n                              alert(\"Share effacé !\");\n                              setTimeout(this.$router.push({ name: 'wall' }), 3000);\n                              this.$router.go(0);\n                            })\n                            .catch( (error) => { alert(error);\n                            })\n                          }else{\n                             this.$router.push({ name: 'wall' });\n                             this.$router.go(0);\n                          }\n            },\n          },\n\n          beforeMount () {\n                            const  Token = JSON.parse(sessionStorage.getItem(\"Token\"));\n                            const loggedUserId=JSON.parse(sessionStorage.getItem(\"UserId\"))\n                            const ShareId = new URL(window.location.href).hash.split(\"=\")[1];\n                           \n                           // LES COMMENTAIRES    \n\n                            fetch(`http://localhost:3000/api/comments/${ShareId}`, {\n                            method: 'GET',\n                            headers: {\"Content-Type\": \"application/json\", \n                                      \"Authorization\": \"Bearer \" + Token\n                            },\n                            mode : \"cors\"\n                            })\n                            .then((res) => {\n                              return res.json();\n                            })\n                            .then((res) =>{\n                              this.loggedUserId = loggedUserId;\n                              this.apiCommentsResponse=res\n                              this.apiLength = res.length\n                            })\n                            .catch( (error) => { alert(error);\n                            });\n          },\n}\n</script>\n\n<style lang=\"scss\" scoped>\n\n\n\n</style>"]},"metadata":{},"sourceType":"module"}