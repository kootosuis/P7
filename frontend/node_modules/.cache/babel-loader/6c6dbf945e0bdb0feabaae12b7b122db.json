{"ast":null,"code":"export default {\n  name: 'UserModifyCompByAdmin',\n\n  data() {\n    return {\n      UserName: \"\",\n      UserFirstname: \"\",\n      UserEmail: \"\",\n      UserPresentation: \"\",\n      UserDepartement: \"\",\n      UserRole: \"\",\n      UserPassword: \"\",\n      UserHabilitation: \"\",\n      success: \"\",\n      message: \"\",\n      //message d'erreur\n      AdminLength: {\n        type: Boolean,\n        default: false\n      },\n      isAdmin: {\n        type: Boolean,\n        default: false\n      }\n    };\n  },\n\n  beforeMount() {\n    this.isAdmin = sessionStorage.getItem(\"isAdmin\");\n    const UserId = new URL(window.location.href).hash.split(\"/modifyByAdmin/\")[1];\n    const Token = JSON.parse(sessionStorage.getItem(\"Token\")); ///----- on vérifie d'abord qu'il y a au minimum deux administrateurs ----///\n\n    fetch(`http://localhost:3000/api/auth/safeAdmin`, {\n      method: 'GET',\n      headers: {\n        \"Content-Type\": \"application/json\",\n        \"Authorization\": \"Bearer \" + Token\n      },\n      mode: \"cors\"\n    }).then(res => {\n      return res.json();\n    }).then(res => {\n      if (res.length > 2) {\n        this.AdminLength = true;\n      } else {\n        this.AdminLength = false;\n      }\n    }).catch(error => {\n      alert(error);\n    }); ///----on peut ensuite accèder au profil User------///\n\n    fetch(`http://localhost:3000/api/auth/${UserId}`, {\n      method: 'GET',\n      headers: {\n        \"Content-Type\": \"application/json\",\n        \"Authorization\": \"Bearer \" + Token\n      },\n      mode: \"cors\"\n    }).then(res => {\n      return res.json();\n    }).then(res => {\n      this.UserName = res.UserName;\n      this.UserFirstname = res.UserFirstname;\n      this.UserEmail = res.UserEmail;\n      this.UserPresentation = res.UserPresentation;\n      this.UserDepartement = res.UserDepartement;\n      this.UserRole = res.UserRole;\n      this.UserPassword = res.UserPassword; // this.UserHabilitation=res.UserHabilitation\n    }).catch(error => {\n      alert(error);\n    });\n  },\n\n  methods: {\n    checkForm() {\n      if (document.getElementById(\"UserName\").checkValidity() && document.getElementById(\"UserFirstname\").checkValidity() && document.getElementById(\"UserEmail\").checkValidity() && document.getElementById(\"UserPassword\").checkValidity()) {\n        document.getElementById(\"UserSignupBtn\").disabled = false;\n      } else {\n        document.getElementById(\"UserSignupBtn\").disabled = true;\n      }\n    },\n\n    goBacKToForum() {\n      this.$router.push({\n        name: 'wall'\n      });\n    },\n\n    modifySignup(e) {\n      e.preventDefault();\n      const Token = JSON.parse(sessionStorage.getItem(\"Token\"));\n      const UserName = document.getElementById(\"UserName\").value;\n      const UserFirstname = document.getElementById(\"UserFirstname\").value;\n      const UserEmail = document.getElementById(\"UserEmail\").value;\n      const UserPresentation = document.getElementById(\"UserPresentation\").value;\n      const UserDepartement = document.getElementById(\"UserDepartement\").value;\n      const UserRole = document.getElementById(\"UserRole\").value;\n      const UserPassword = document.getElementById(\"UserPassword\").value;\n      const UserHabilitation = document.getElementById(\"UserHabilitation\").value;\n      const User = {\n        \"UserName\": UserName,\n        \"UserFirstname\": UserFirstname,\n        \"UserEmail\": UserEmail,\n        \"UserDepartement\": UserDepartement,\n        \"UserPresentation\": UserPresentation,\n        \"UserRole\": UserRole,\n        \"UserPassword\": UserPassword,\n        \"UserHabilitation\": UserHabilitation\n      };\n      fetch(\"http://localhost:3000/api/auth/modifySignup\", {\n        method: 'PUT',\n        body: JSON.stringify(User),\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"Authorization\": \"Bearer \" + Token\n        },\n        mode: \"cors\"\n      }).then(response => {\n        if (response.status == 201) {\n          response.json().then(res => {\n            console.log(res);\n            this.success = true;\n            this.message = \"Mise à jour effectuée\";\n            sessionStorage.setItem(\"isAdmin\", JSON.stringify(response.UserHabilitation));\n            setTimeout(() => this.$router.push({\n              name: 'wall'\n            }), 4000);\n          });\n        } else {\n          response.json().then(json => {\n            this.success = false;\n            console.log(json);\n            this.message = json.error;\n          });\n        }\n      }).catch(() => {\n        this.success = false;\n        this.message = `Le serveur ne répond pas ! Veuillez réessayer ultérieurement`;\n      });\n    },\n\n    deleteAccount() {\n      const UserId = JSON.parse(sessionStorage.getItem(\"UserId\"));\n      const Token = JSON.parse(sessionStorage.getItem(\"Token\"));\n      fetch(`http://localhost:3000/api/auth/delete/${UserId}`, {\n        method: 'DELETE',\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"Authorization\": \"Bearer \" + Token\n        },\n        mode: \"cors\"\n      }).then(sessionStorage.removeItem(\"UserId\"), sessionStorage.removeItem(\"Token\"), sessionStorage.removeItem(\"isAdmin\"));\n    }\n\n  }\n};","map":{"version":3,"mappings":"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","names":["name","data","UserName","UserFirstname","UserEmail","UserPresentation","UserDepartement","UserRole","UserPassword","UserHabilitation","success","message","AdminLength","type","Boolean","default","isAdmin","beforeMount","sessionStorage","getItem","UserId","URL","window","location","href","hash","split","Token","JSON","parse","fetch","method","headers","mode","then","res","json","length","catch","error","alert","methods","checkForm","document","getElementById","checkValidity","disabled","goBacKToForum","$router","push","modifySignup","e","preventDefault","value","User","body","stringify","response","status","console","log","setItem","setTimeout","deleteAccount","removeItem"],"sourceRoot":"","sources":["/Users/stefan/Library/Mobile Documents/com~apple~CloudDocs/08 WEB ET SITES/P7/frontend/src/components/UserModifyCompByAdmin.vue"],"sourcesContent":["<template>\n    <section class = \"container\">\n      <div class = \"formSection\">\n\n          <div class=\"please\" >\n            <h2> Vous pouvez mettre à jour les données de votre compte </h2>\n          </div>\n\n          <div class = \"formDiv\">\n                    <form     class=\"formulaire\"\n                              method=\"PUT\" \n                              name=\"form\" \n                              id=\"form\" \n\n                              @submit = \"modifySignup\">\n                             \n                              <!--Le Nom-->\n                              <div class=\"formLine\">\n                                        <label\n                                                  for=\"UserName\" \n                                                  class=\"label\">Nom <span class=\"asterisque\">*</span></label>\n                                        <input    class=\"input\"\n                                                  v-model=\"UserName\" \n                                                  @input = \"checkForm\"    \n                                                  type=\"text\" \n                                                  placeholder=\"Entrez votre nom.\" \n                                                  id=\"UserName\" \n                                                  name=\"UserName\" \n                                                  required=\"required\">\n                              </div>\n\n                              <!--Le Prénom-->\n                              <div class=\"formLine\">\n                                        <label \n                                                  for=\"UserFirstname\" \n                                                  class=\"label\">Prénom <span class=\"asterisque\">*</span></label>\n                                        <input    class=\"input\"\n                                                  v-model=\"UserFirstname\" \n                                                  @input = \"checkForm\"  \n                                                  type=\"text\" \n                                                  placeholder=\"Entrez votre prénom.\" \n                                                  id=\"UserFirstname\" \n                                                  name=\"UserFirstname\" \n                                                  required=\"required\">\n                              </div>\n\n                              <!--L'Email'-->\n                               <div class=\"formLine\">\n                                        <label    \n                                                  for=\"UserEmail\" \n                                                  class=\"label\">Email <span class=\"asterisque\">*</span></label>\n                                        <input    class=\"input\"\n                                                  v-model=\"UserEmail\" \n                                                  @input = \"checkForm\"    \n                                                  type=\"email\" \n                                                  placeholder=\"Entrez une adresse mail valide.\" \n                                                  id=\"UserEmail\"\n                                                  name=\"UserEmail\" \n                                                  required=\"\">\n                              </div>\n\n                              <!--La Présentation-->\n                              <div class=\"formLine\">\n                                        <label \n                                                  for=\"UserPresentation\" \n                                                  class=\"label\">Présentation</label>\n                                        <textarea   class=\"smalltextarea input\"\n                                                  v-model=\"UserPresentation\" \n                                                  type=\"textarea\"\n                                                  placeholder=\"Si vous le souhaitez, vous pouvez vous présenter...\" \n                                                  id=\"UserPresentation\" \n                                                  name=\"UserPresentation\" \n                                                  ></textarea>\n                              </div>\n\n                              <!--Le Service-->\n                              <div class=\"formLine\">\n                                        <label \n                                                  for=\"UserDepartement\" \n                                                  class=\"label\">Service <span class=\"asterisque\">*</span></label>\n\n                                          <select class=\"input\"\n                                                  id=\"UserDepartement\" \n                                                  name=\"UserDepartement\"\n                                                  v-model=\"UserDepartement\"  \n                                                  required=\"required\">\n                                                    <option value=\"...\">...</option>\n                                                    <option value=\"communication\">communication</option>\n                                                    <option value=\"administration\">administration</option>\n                                                    <option value=\"siège\">siège</option>\n                                                    <option value=\"R&amp;D\">R&amp;D</option>\n                                                    <option value=\"magasin 1\">magasin 1</option>\n                                                    <option value=\"magasin 2\">magasin 2</option>\n                                                    <option value=\"etc.\">etc.</option>\n                                          </select>\n                              </div>\n\n                              <!--Le Role-->\n                              <div class=\"formLine\">\n                                        <label    \n                                        for=\"UserRole\" \n                                                  class=\"label\">Rôle</label>\n                                        <textarea    class=\"smalltextarea input\"\n                                                  v-model=\"UserRole\" \n                                                  type=\"textarea\" \n                                                  placeholder=\"Quel est votre rôle dans l'entreprise ?\" \n                                                  id=\"UserRole\" \n                                                  name=\"UserRole\"></textarea>\n                              </div>\n\n                              <!--Le Mot de passe -->\n                              <div class=\"formLine\">\n                                        <label    \n                                                  for=\"UserPassword\" \n                                                  class=\"label\">Mot de passe <span class=\"asterisque\">*</span></label>\n                                        <input    class=\"input\"\n                                                  v-model=\"UserPassword\" \n                                                  @input = \"checkForm\"    \n                                                  type=\"password\" \n                                                  id=\"UserPassword\" \n                                                  name=\"UserPassword\" \n                                                  maxlength=\"30\">\n                              </div>\n                              <div class=\"formLine formLineTop\">\n                                <div class=\"label\"></div>\n                                <p class=\"hint input\"> Vous pouvez changer de mot de passe.<br/><br/>\n                                                       Le mot de passe doit contenir au minimum 8 caractères, dont une majuscule, une minuscule, un chiffre et un caractère spécial.</p>\n                              </div>\n\n                              <!--L'habilitation -->\n                              <div class=\"formLine\" v-if=\"isAdmin\">\n                                        <label    \n                                                  for=\"UserHabilitation\" \n                                                  class=\"label\">Habilitation</label>\n                                        <div     \n                                                  class=\"input\">\n                                                  <select     id=\"UserHabilitation\" \n                                                            name=\"UserHabilitation\" \n                                                            required=\"required\">\n                                                                      <option value=1>avec habilitation à administrer</option>\n                                                                                      \n                                                  </select>                                                         \n                                        </div>\n                              </div>\n\n                              <div class=\"asterisque\" style=\"text-align:right\"> * Champs requis </div>\n\n                              <div class=\"btn-div\">\n                                        <button type=\"button\" class=\"btn\" @click=\"goBacKToForum()\" id=\"CancelBtn\">Annuler</button>\n                                        <input type=\"submit\"  class=\"btn\" id=\"UserSignupBtn\" value=\"Mettre à jour\" disabled>           \n                              </div>\n       \n                    </form>\n\n                    <!-- A FAIRE : implementer des components modaux -->\n\n                    <div class=\"add-div\" v-show=\"success===true\">\n                      <p id=\"erreur\" > Tout va bien : {{message}} </p>\n                    </div>\n                    <div class=\"add-div\" v-show=\"success===false\">\n                      <p id=\"erreur\" > Echec de la mise à jour : {{message}} </p>\n                    </div>\n\n                    <div id=\"no-account\" class=\"add-div\">\n                      <p> Vous pouvez si vous le souhaitez, effacer votre compte ainsi que tous les partages et commentaires qui y sont liés</p>\n                      <div class=\"btn-div\"><router-link @click=\"deleteAccount()\" class=\"btn\" to=\"../deconnect\">Effacer</router-link> </div>\n                    </div>\n\n          </div>\n       </div>\n    </section>\n</template>\n\n<script>\nexport default {\n  name: 'UserModifyCompByAdmin',\n  \n  data() {\n    return {\n    UserName:\"\",\n    UserFirstname:\"\", \n    UserEmail:\"\", \n    UserPresentation:\"\",\n    UserDepartement:\"\", \n    UserRole:\"\", \n    UserPassword:\"\",\n    UserHabilitation:\"\",     \n    success:\"\",\n    message :\"\", //message d'erreur\n\n    AdminLength : {\n      type: Boolean,\n      default : false\n    },\n\n    isAdmin: {\n      type: Boolean,\n      default : false\n    }\n\n    }\n  },\n\n   beforeMount () {\n    this.isAdmin = sessionStorage.getItem(\"isAdmin\");\n    const  UserId = new URL(window.location.href).hash.split(\"/modifyByAdmin/\")[1];\n    const  Token = JSON.parse(sessionStorage.getItem(\"Token\"));\n\n          ///----- on vérifie d'abord qu'il y a au minimum deux administrateurs ----///\n          fetch(`http://localhost:3000/api/auth/safeAdmin`, {\n          method: 'GET',\n          headers: {\"Content-Type\": \"application/json\", \n                    \"Authorization\": \"Bearer \" + Token\n           },\n           mode : \"cors\"\n          })\n          .then((res) => {\n            return res.json();\n          })\n          .then((res) =>{\n            if (res.length > 2) {\n              this.AdminLength = true\n            } else {\n              this.AdminLength = false\n            }\n          })\n          .catch( (error) => { alert(error);\n          });\n\n\n          ///----on peut ensuite accèder au profil User------///\n          fetch(`http://localhost:3000/api/auth/${UserId}`, {\n          method: 'GET',\n          headers: {\"Content-Type\": \"application/json\", \n                    \"Authorization\": \"Bearer \" + Token\n           },\n           mode : \"cors\"\n          })\n          .then((res) => {\n            return res.json();\n          })\n          .then((res) =>{\n            this.UserName = res.UserName;\n            this.UserFirstname = res.UserFirstname;\n            this.UserEmail = res.UserEmail;\n            this.UserPresentation = res.UserPresentation;\n            this.UserDepartement = res.UserDepartement;\n            this.UserRole = res.UserRole;\n            this.UserPassword = res.UserPassword;\n            // this.UserHabilitation=res.UserHabilitation\n          })\n          .catch( (error) => { alert(error);\n          });\n        },\n\n  methods: {\n\n    checkForm() {\n\n      if (document.getElementById(\"UserName\").checkValidity() \n      && document.getElementById(\"UserFirstname\").checkValidity() \n      && document.getElementById(\"UserEmail\").checkValidity()\n      && document.getElementById(\"UserPassword\").checkValidity()\n      ) {\n        document.getElementById(\"UserSignupBtn\").disabled = false\n      }\n      else {document.getElementById(\"UserSignupBtn\").disabled = true;\n    }},\n    \n    goBacKToForum(){\n      this.$router.push({ name: 'wall' })\n    },\n\n    modifySignup(e) {\n\n      e.preventDefault();\n\n      const Token = JSON.parse(sessionStorage.getItem(\"Token\"));\n\n      const UserName = document.getElementById(\"UserName\").value\n      const UserFirstname = document.getElementById(\"UserFirstname\").value\n      const UserEmail = document.getElementById(\"UserEmail\").value\n      const UserPresentation = document.getElementById(\"UserPresentation\").value\n      const UserDepartement= document.getElementById(\"UserDepartement\").value\n      const UserRole = document.getElementById(\"UserRole\").value;\n      const UserPassword = document.getElementById(\"UserPassword\").value;\n      const UserHabilitation = document.getElementById(\"UserHabilitation\").value;\n\n      const User = { \"UserName\": UserName,\n                     \"UserFirstname\": UserFirstname,\n                     \"UserEmail\": UserEmail,\n                     \"UserDepartement\": UserDepartement,\n                     \"UserPresentation\": UserPresentation,\n                     \"UserRole\": UserRole,\n                      \"UserPassword\": UserPassword,\n                     \"UserHabilitation\" : UserHabilitation,\n      }\n\n      fetch(\"http://localhost:3000/api/auth/modifySignup\", {\n          method: 'PUT',\n          body: JSON.stringify(User),\n          headers: {\"Content-Type\": \"application/json\", \n                    \"Authorization\": \"Bearer \" + Token\n           },\n           mode : \"cors\"\n          })\n      .then((response) => {\n                    if (response.status == 201) { \n                              response.json()\n                              .then((res) => {\n\n                                console.log(res);\n                                    this.success= true;\n                                    this.message =  \"Mise à jour effectuée\"\n                                    sessionStorage.setItem(\"isAdmin\", JSON.stringify(response.UserHabilitation));\n                                    setTimeout(() => this.$router.push({ name: 'wall' }), 4000)\n                              })\n                    } else {\n                              response.json ()\n                              .then ((json) => {\n                              this.success= false;\n                              console.log(json);\n                              this.message = json.error;\n                              })\n                    }\n       })\n      .catch (() => {\n              this.success= false;\n              this.message = `Le serveur ne répond pas ! Veuillez réessayer ultérieurement`;\n      })         \n    },\n    \n    deleteAccount(){\n\n      const  UserId = JSON.parse(sessionStorage.getItem(\"UserId\"));\n      const  Token = JSON.parse(sessionStorage.getItem(\"Token\"));\n\n      fetch(`http://localhost:3000/api/auth/delete/${UserId}`, {\n          method: 'DELETE',\n          headers: {\"Content-Type\": \"application/json\", \n                    \"Authorization\": \"Bearer \" + Token\n           },\n          mode :\"cors\"\n      }).then(\n        sessionStorage.removeItem(\"UserId\"),\n        sessionStorage.removeItem(\"Token\"),\n        sessionStorage.removeItem(\"isAdmin\")\n      )\n    }\n  }\n}             \n  \n</script>\n\n<style lang=\"scss\" scoped>\n\n\n</style>"]},"metadata":{},"sourceType":"module"}