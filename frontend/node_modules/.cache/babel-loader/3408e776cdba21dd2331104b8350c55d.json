{"ast":null,"code":"import { renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, createCommentVNode as _createCommentVNode, vShow as _vShow, withDirectives as _withDirectives, resolveComponent as _resolveComponent, createBlock as _createBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"mainshares shares\"\n};\nconst _hoisted_2 = {\n  class: \"card\",\n  id: \"shareAloneComments\"\n};\nconst _hoisted_3 = {\n  key: 0\n};\nconst _hoisted_4 = {\n  key: 0\n};\nconst _hoisted_5 = {\n  class: \"card__info--text card__info--sharetext\"\n};\nconst _hoisted_6 = {\n  class: \"formSection\",\n  id: \"ShareForm\"\n};\nconst _hoisted_7 = {\n  class: \"formDiv\"\n};\nconst _hoisted_8 = {\n  type: \"multipart/form-data\",\n  method: \"POST\",\n  name: \"form\",\n  id: \"CommentToBePosted\",\n  class: \"formulaire\"\n};\nconst _hoisted_9 = {\n  class: \"formLine\"\n};\n\nconst _hoisted_10 = /*#__PURE__*/_createElementVNode(\"label\", {\n  for: \"CommentText\",\n  class: \"label\"\n}, \"Votre commentaire\", -1\n/* HOISTED */\n);\n\nconst _hoisted_11 = {\n  class: \"btn-div\"\n};\n\nconst _hoisted_12 = /*#__PURE__*/_createElementVNode(\"div\", {\n  class: \"separator\"\n}, null, -1\n/* HOISTED */\n);\n\nconst _hoisted_13 = {\n  class: \"card__info--complement\"\n};\nconst _hoisted_14 = {\n  hidden: \"\"\n};\nconst _hoisted_15 = {\n  hidden: \"\",\n  id: \"CommentOnACommentId\"\n};\nconst _hoisted_16 = {\n  class: \"btn-div\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_PostACommentOnAComment = _resolveComponent(\"PostACommentOnAComment\");\n\n  return _openBlock(), _createElementBlock(\"section\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.apiCommentsResponse, item => {\n    return _openBlock(), _createElementBlock(\"div\", {\n      id: \"commentDiv\",\n      key: item.shareShareId,\n      class: \"card card__info card__info--2\"\n    }, [item.CommentId ? (_openBlock(), _createElementBlock(\"div\", _hoisted_3, [$data.modifyCommentBox ? (_openBlock(), _createElementBlock(\"div\", _hoisted_4, [_createElementVNode(\"p\", _hoisted_5, _toDisplayString(item.CommentText), 1\n    /* TEXT */\n    )])) : _createCommentVNode(\"v-if\", true), _createElementVNode(\"div\", _hoisted_6, [_createElementVNode(\"div\", _hoisted_7, [_createElementVNode(\"form\", _hoisted_8, [_createCommentVNode(\"Le Comment\"), _createElementVNode(\"div\", _hoisted_9, [_hoisted_10, _createElementVNode(\"textarea\", {\n      class: \"bigtextarea textarea input\",\n      form: \"CommentToBePosted\",\n      type: \"textarea\",\n      onInput: _cache[0] || (_cache[0] = (...args) => _ctx.checkForm && _ctx.checkForm(...args)),\n      placeholder: \"...\",\n      autofocus: \"\",\n      id: \"CommentText\",\n      name: \"CommentText\"\n    }, null, 32\n    /* HYDRATE_EVENTS */\n    )]), _createElementVNode(\"div\", _hoisted_11, [_createElementVNode(\"button\", {\n      type: \"button\",\n      class: \"btn\",\n      onClick: _cache[1] || (_cache[1] = $event => _ctx.displayGoTo()),\n      id: \"CancelBtn\"\n    }, \"Annuler\"), _createElementVNode(\"button\", {\n      type: \"button\",\n      class: \"btn\",\n      onClick: _cache[2] || (_cache[2] = $event => _ctx.Comment()),\n      id: \"CommentBtn\",\n      disabled: \"\"\n    }, \"Commenter\")])])])]), _hoisted_12, _createElementVNode(\"div\", _hoisted_13, [_createElementVNode(\"div\", null, [_createElementVNode(\"p\", null, _toDisplayString(item.user.UserFirstname) + \" \" + _toDisplayString(item.user.UserName) + \" / \" + _toDisplayString(item.user.UserDepartement) + \" / \" + _toDisplayString(item.user.UserRole), 1\n    /* TEXT */\n    ), _createElementVNode(\"p\", null, _toDisplayString($options.formatDate(item.updatedAt)), 1\n    /* TEXT */\n    ), _createCommentVNode(\" le commentateur du Share \"), _createElementVNode(\"p\", _hoisted_14, _toDisplayString(item.commentCommentId), 1\n    /* TEXT */\n    ), _createElementVNode(\"p\", _hoisted_15, _toDisplayString(item.CommentId), 1\n    /* TEXT */\n    )])])])) : _createCommentVNode(\"v-if\", true), _createElementVNode(\"div\", _hoisted_16, [_withDirectives(_createElementVNode(\"button\", {\n      type: \"button\",\n      class: \"btn\",\n      onClick: _cache[3] || (_cache[3] = $event => $options.modifyComment()),\n      id: \"modifyCommentBtn\"\n    }, \"Corriger\", 512\n    /* NEED_PATCH */\n    ), [[_vShow, item.userUserId == $data.loggedUserId || $data.isAdmin]]), _withDirectives(_createElementVNode(\"button\", {\n      type: \"button\",\n      class: \"btn\",\n      onClick: _cache[4] || (_cache[4] = $event => $options.deleteComment()),\n      id: \"deleteCommentBtn\"\n    }, \"Effacer\", 512\n    /* NEED_PATCH */\n    ), [[_vShow, item.userUserId == $data.loggedUserId || $data.isAdmin]])]), item.userUserId != $data.loggedUserId || $data.isAdmin == 1 ? (_openBlock(), _createBlock(_component_PostACommentOnAComment, {\n      key: 1\n    })) : _createCommentVNode(\"v-if\", true)]);\n  }), 128\n  /* KEYED_FRAGMENT */\n  ))])]);\n}","map":{"version":3,"mappings":"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","names":["class","id","type","method","name","_createElementVNode","for","hidden","_createElementBlock","_Fragment","_renderList","$data","item","key","shareShareId","CommentId","_hoisted_3","_hoisted_4","_toDisplayString","CommentText","_createCommentVNode","_hoisted_10","form","onInput","_ctx","placeholder","autofocus","onClick","disabled","_hoisted_12","user","UserFirstname","UserName","UserDepartement","UserRole","$options","updatedAt","commentCommentId","userUserId","_createBlock","_component_PostACommentOnAComment"],"sourceRoot":"","sources":["/Users/stefan/Library/Mobile Documents/com~apple~CloudDocs/08 WEB ET SITES/P7/frontend/src/components/ShareAloneComments.vue"],"sourcesContent":["<template>\n\n                    <section class=\"mainshares shares\">\n\n                          <div class=\"card\" id=\"shareAloneComments\" >\n                              <div  id=\"commentDiv\" \n                                v-for=\"item in apiCommentsResponse\"\n                                :key=\"item.shareShareId\"\n                                class=\"card card__info card__info--2\">\n                                      <div v-if=\"item.CommentId\" >\n                                        <div v-if=\"modifyCommentBox\">\n                                          <p class=\"card__info--text card__info--sharetext\">{{ item.CommentText }}</p>\n                                        </div>\n\n                                        <div class = \"formSection\" id=\"ShareForm\" >\n                            <div class = \"formDiv\">\n                                      <form     \n                                                type=\"multipart/form-data\"\n                                                method=\"POST\" \n                                                name=\"form\" \n                                                id=\"CommentToBePosted\"\n                                                class=\"formulaire\">\n                                                \n                                                <!--Le Comment-->\n                                                <div class=\"formLine\">\n                                                          <label    \n                                                                    for=\"CommentText\" \n                                                                    class=\"label\">Votre commentaire</label>\n                                                          <textarea class=\"bigtextarea textarea input\"\n                                                                    form=\"CommentToBePosted\" \n                                                                    type=\"textarea\"\n                                                                    @input=\"checkForm\"\n                                                                  \n                                                                    placeholder= \"...\"\n                                                                    autofocus\n                                                                    id=\"CommentText\"\n                                                                    name=\"CommentText\"></textarea>\n                                                </div>\n                                                \n                                                <div class=\"btn-div\">\n                                                          <button type=\"button\" class=\"btn\" @click=\"displayGoTo()\" id=\"CancelBtn\">Annuler</button>\n                                                          <button type=\"button\" class=\"btn\" @click=\"Comment()\" id=\"CommentBtn\" disabled>Commenter</button>\n                                                </div>\n                                      </form>\n                            </div>\n                        </div>\n                                        <div class=\"separator\"></div>\n                                        <div class=\"card__info--complement\">\n                                          <div>\n                                            <p> {{ item.user.UserFirstname }} {{ item.user.UserName }} / {{ item.user.UserDepartement }} / {{ item.user.UserRole }}</p>\n                                            <p>{{ formatDate(item.updatedAt) }}</p> <!-- le commentateur du Share -->\n                                            <p hidden>{{ item.commentCommentId }} </p>\n                                            <p hidden id=\"CommentOnACommentId\">{{ item.CommentId }}</p>\n                                          </div>\n                                        \n                                        </div>\n      \n                                      </div>\n\n                                      <div class=\"btn-div\">\n                                              <button v-show=\"item.userUserId==loggedUserId  || isAdmin\" type=\"button\" class=\"btn\" @click=\"modifyComment()\" id=\"modifyCommentBtn\">Corriger</button>\n                                              <button v-show=\"item.userUserId==loggedUserId  || isAdmin\" type=\"button\" class=\"btn\" @click=\"deleteComment()\" id=\"deleteCommentBtn\">Effacer</button>\n                                      </div>\n\n                                      <PostACommentOnAComment v-if=\"item.userUserId!=loggedUserId || isAdmin == 1\"/>\n                            </div>\n                        </div>\n\n                      \n                        \n    \n                    </section>\n\n                    \n                    \n\n          \n</template>\n\n<script>\nimport PostACommentOnAComment from \"@/components/PostACommentOnAComment.vue\"\nimport dayjs from 'dayjs'\nrequire('dayjs/locale/fr')\ndayjs.locale('fr')\n\nexport default {\n          name : 'ShareAlone',\n          components: {\n                              PostACommentOnAComment\n          },\n\n          \n\n          data(){\n                    return{\n\n                            loggedUserId: \"\",\n                            apiCommentsResponse : Array,\n                            apiLength : Number,\n\n                            CommentId : \"\",\n                            CommentText : \"\",\n                            CommentcreatedAt : \"\",\n                            CommentupdatedAt : \"\",\n                            CommentuserUserId : \"\", \n\n                            modifyCommentBox :{\n                              type: Boolean,\n                              default: true },\n\n                            isAdmin :{\n                              type: Boolean,\n                              default: false },\n\n                    }\n          },\n\n          methods : {\n\n            formatDate(dateString) {\n                            const date = dayjs(dateString);\n                                // Then specify how you want your dates to be formatted\n                            return date.format('dddd D MMMM YYYY , HH:mm');\n                      },\n\n            modifyComment() {\n                  this.modifyCommentBox = false;\n            },\n            doNotModify(){\n                  this.modifyCommentBox = true;\n            },\n\n            correctComment(){\n                    const ShareToBeCorrected = document.getElementById(\"ShareToBeCorrected\");\n                    const ShareId = new URL(window.location.href).hash.split(\"=\")[1];\n                    const Token = JSON.parse(sessionStorage.getItem(\"Token\"));\n                    const Modify = new FormData(ShareToBeCorrected);\n\n                    Modify.append('ShareId',ShareId)\n\n\n                    //--- TEST ---- ///\n                    // for(var pair of Modify.entries()) {\n                    //   console.log(pair[0]+ ', '+ pair[1]);\n                    // }\n\n                    fetch(`http://localhost:3000/api/shares/${ShareId}`, {\n                              method: 'PUT',\n                              headers: {\n                                  \"Accept\":\"*/*\",\n                                  // \"Content-Type\": \"multipart/form-data\", \n                                  \"Authorization\": \"Bearer \" + Token\n                              },\n                              body: Modify,\n                              mode : \"cors\"})\n\n                    .then((response) => {\n\n                              if (response.status == 201) { \n                                        this.success= true;\n                                        this.message = \"Mise à jour effectuée.\";\n                                        this.modifyForm = true;\n                                        this.$router.push({ name: 'wall' });\n                                        this.$router.go(0);\n                                        // history.go(0);\n                              } else {\n                                        response.json ()\n                                        .then ((json) => {\n                                        this.success= false;\n                                        console.log(json);\n                                        this.message = json.error ||  json.message ;\n                                        return this.message\n                                        })\n                              }\n                    })\n                    .catch (() => {\n                              this.success= false;\n                              this.message = `Le serveur ne répond pas ! Veuillez réessayer ultérieurement`;\n                    })         \n\n            },\n            deleteComment() {\n\n                          const  Token = JSON.parse(sessionStorage.getItem(\"Token\"));\n                          // const loggedUserId=JSON.parse(sessionStorage.getItem(\"UserId\"))\n                          const ShareId = new URL(window.location.href).hash.split(\"=\")[1];\n                          const Share = {\n                            \"ShareId\" : ShareId\n                          }\n\n                          const deleteShare = confirm(\"Le commentaire et tous les commentaires associés vont être effacés\")\n\n                          if (deleteShare){\n                            fetch(`http://localhost:3000/api/comments/${ShareId}`, {\n                              method: 'DELETE',\n                              headers: {\"Content-Type\": \"application/json\", \n                                        \"Authorization\": \"Bearer \" + Token\n                              },\n                              body: JSON.stringify(Share),\n                              mode : \"cors\"\n                            })\n                            .then(() => {\n                              alert(\"Share effacé !\");\n                              setTimeout(this.$router.push({ name: 'wall' }), 3000);\n                              this.$router.go(0);\n                            })\n                            .catch( (error) => { alert(error);\n                            })\n                          }else{\n                             this.$router.push({ name: 'wall' });\n                             this.$router.go(0);\n                          }\n            },\n          },\n\n          beforeMount () {\n                            const  Token = JSON.parse(sessionStorage.getItem(\"Token\"));\n                            const loggedUserId=JSON.parse(sessionStorage.getItem(\"UserId\"))\n                            const ShareId = new URL(window.location.href).hash.split(\"=\")[1];\n\n                            this.isAdmin = sessionStorage.getItem(\"isAdmin\");\n                           \n                           // LES COMMENTAIRES    \n\n                            fetch(`http://localhost:3000/api/comments/${ShareId}`, {\n                            method: 'GET',\n                            headers: {\"Content-Type\": \"application/json\", \n                                      \"Authorization\": \"Bearer \" + Token\n                            },\n                            mode : \"cors\"\n                            })\n                            .then((res) => {\n                              return res.json();\n                            })\n                            .then((res) =>{\n                              this.loggedUserId = loggedUserId;\n                              this.apiCommentsResponse=res\n                              this.apiLength = res.length\n                            })\n                            .catch( (error) => { alert(error);\n                            });\n          },\n}\n</script>\n\n<style lang=\"scss\" scoped>\n\n\n\n</style>"]},"metadata":{},"sourceType":"module"}